{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agentic-primitives.dev/specs/v1/hook-meta.schema.json",
  "specVersion": "v1",
  "title": "Hook Primitive Metadata Schema (v1)",
  "description": "Schema for hook primitive metadata files (lifecycle event handlers)",
  "type": "object",
  "required": ["id", "kind", "category", "event", "summary", "execution"],
  "additionalProperties": false,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
      "minLength": 2,
      "maxLength": 64,
      "description": "Unique identifier in kebab-case (must match folder name)",
      "examples": ["pre-tool-use", "post-tool-use", "session-start"]
    },
    "kind": {
      "type": "string",
      "enum": ["hook"],
      "description": "Type of primitive (always 'hook')"
    },
    "category": {
      "type": "string",
      "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
      "minLength": 2,
      "maxLength": 64,
      "description": "Category for organizing hooks (e.g., 'lifecycle', 'safety', 'observability')",
      "examples": ["lifecycle", "safety", "observability", "control", "notification"]
    },
    "event": {
      "type": "string",
      "enum": [
        "PreToolUse",
        "PostToolUse",
        "UserPromptSubmit",
        "Stop",
        "SubagentStop",
        "SessionStart",
        "SessionEnd",
        "PreCompact",
        "Notification"
      ],
      "description": "Claude Agent SDK hook event this responds to"
    },
    "summary": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "Brief description of what this hook does and when it executes"
    },
    "execution": {
      "type": "object",
      "required": ["strategy"],
      "additionalProperties": false,
      "description": "Execution configuration for middleware pipeline",
      "properties": {
        "strategy": {
          "type": "string",
          "enum": ["pipeline", "parallel"],
          "description": "How to execute middleware: pipeline (sequential with fail-fast) or parallel (all run simultaneously)"
        },
        "timeout_sec": {
          "type": "integer",
          "minimum": 1,
          "maximum": 300,
          "description": "Maximum execution time in seconds",
          "default": 60
        },
        "fail_on_error": {
          "type": "boolean",
          "description": "Whether to fail if any middleware errors",
          "default": true
        }
      }
    },
    "middleware": {
      "type": "array",
      "description": "Ordered list of middleware functions to execute",
      "items": {
        "type": "object",
        "required": ["id", "path", "type"],
        "additionalProperties": false,
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z0-9]+(-[a-z0-9]+)*$",
            "description": "Unique identifier for this middleware"
          },
          "path": {
            "type": "string",
            "description": "Relative path to middleware implementation from hook directory"
          },
          "type": {
            "type": "string",
            "enum": ["safety", "observability", "analytics"],
            "description": "Middleware type: safety (blocking), observability (non-blocking), or analytics (non-blocking)"
          },
          "enabled": {
            "type": "boolean",
            "description": "Whether this middleware is active",
            "default": true
          },
          "priority": {
            "type": "integer",
            "minimum": 0,
            "maximum": 100,
            "description": "Execution priority (lower numbers run first in pipeline mode)",
            "default": 50
          },
          "config": {
            "type": "object",
            "description": "Middleware-specific configuration parameters"
          }
        }
      }
    },
    "default_decision": {
      "type": "string",
      "enum": ["allow", "block"],
      "description": "Default decision when no middleware blocks",
      "default": "allow"
    },
    "providers": {
      "type": "object",
      "additionalProperties": false,
      "description": "Provider-specific hook configurations",
      "properties": {
        "claude": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "impl_file": {
              "type": "string",
              "pattern": "^impl\\.(python|bun)\\.(py|ts)$",
              "description": "Main hook orchestrator implementation"
            },
            "matcher": {
              "type": "object",
              "description": "Optional matcher to filter when hook executes",
              "properties": {
                "tool_names": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Only execute for these tool names (PreToolUse)"
                },
                "pattern": {
                  "type": "string",
                  "description": "Regex pattern to match event data"
                }
              }
            }
          }
        }
      }
    },
    "metrics": {
      "type": "object",
      "additionalProperties": false,
      "description": "Metrics configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to emit metrics",
          "default": true
        },
        "backend": {
          "type": "string",
          "enum": ["statsd", "prometheus", "datadog", "none"],
          "description": "Metrics backend to use",
          "default": "none"
        },
        "tags": {
          "type": "object",
          "description": "Default tags to add to all metrics"
        }
      }
    },
    "logging": {
      "type": "object",
      "additionalProperties": false,
      "description": "Logging configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to write logs",
          "default": true
        },
        "level": {
          "type": "string",
          "enum": ["debug", "info", "warn", "error"],
          "description": "Minimum log level",
          "default": "info"
        },
        "output": {
          "type": "string",
          "description": "Log output path (relative or absolute)",
          "default": "logs/hooks.jsonl"
        },
        "format": {
          "type": "string",
          "enum": ["json", "text"],
          "description": "Log format",
          "default": "json"
        }
      }
    }
  },
  "examples": [
    {
      "id": "pre-tool-use",
      "kind": "hook",
      "category": "lifecycle",
      "event": "PreToolUse",
      "summary": "Validate and secure tool usage before execution with safety and observability middleware",
      "execution": {
        "strategy": "pipeline",
        "timeout_sec": 60,
        "fail_on_error": true
      },
      "middleware": [
        {
          "id": "block-dangerous-commands",
          "path": "middleware/safety/block-dangerous-commands.py",
          "type": "safety",
          "enabled": true,
          "priority": 10,
          "config": {
            "patterns": ["rm -rf", "sudo rm", "dd if="],
            "action": "block"
          }
        },
        {
          "id": "protect-sensitive-files",
          "path": "middleware/safety/protect-sensitive-files.py",
          "type": "safety",
          "enabled": true,
          "priority": 20,
          "config": {
            "protected_patterns": [".env*", "*.key", "*.pem", ".git/config"]
          }
        },
        {
          "id": "log-operations",
          "path": "middleware/observability/log-operations.py",
          "type": "observability",
          "enabled": true,
          "priority": 90
        },
        {
          "id": "emit-metrics",
          "path": "middleware/observability/emit-metrics.py",
          "type": "observability",
          "enabled": true,
          "priority": 95,
          "config": {
            "metrics_backend": "statsd",
            "statsd_host": "localhost",
            "statsd_port": 8125
          }
        }
      ],
      "default_decision": "allow",
      "providers": {
        "claude": {
          "impl_file": "impl.python.py"
        }
      },
      "metrics": {
        "enabled": true,
        "backend": "statsd",
        "tags": {
          "hook": "pre-tool-use",
          "environment": "production"
        }
      },
      "logging": {
        "enabled": true,
        "level": "info",
        "output": "logs/pre-tool-use.jsonl",
        "format": "json"
      }
    },
    {
      "id": "session-start",
      "kind": "hook",
      "category": "lifecycle",
      "event": "SessionStart",
      "summary": "Initialize session context and load environment configuration",
      "execution": {
        "strategy": "parallel",
        "timeout_sec": 30
      },
      "middleware": [
        {
          "id": "load-context",
          "path": "middleware/observability/load-context.py",
          "type": "observability",
          "enabled": true
        },
        {
          "id": "setup-logging",
          "path": "middleware/observability/setup-logging.py",
          "type": "observability",
          "enabled": true
        }
      ],
      "default_decision": "allow",
      "providers": {
        "claude": {
          "impl_file": "impl.python.py"
        }
      }
    }
  ]
}

