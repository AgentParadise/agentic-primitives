{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://agentic-primitives.dev/schemas/provider-impl.schema.json",
  "title": "Provider Implementation Schema",
  "description": "Schema for provider-specific implementation files (Claude, OpenAI, local)",
  "type": "object",
  "oneOf": [
    {
      "title": "Claude Tool Implementation",
      "description": "Claude-specific tool binding configuration",
      "type": "object",
      "required": ["provider", "type", "tool"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["claude"],
          "description": "Provider identifier"
        },
        "type": {
          "type": "string",
          "enum": ["bash", "computer", "editor", "http"],
          "description": "Claude tool type"
        },
        "tool": {
          "type": "object",
          "description": "Claude tool configuration",
          "required": ["name"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Tool name in Claude"
            },
            "description": {
              "type": "string",
              "description": "Tool description for Claude"
            },
            "parameters": {
              "type": "object",
              "description": "Tool-specific parameters"
            }
          }
        }
      }
    },
    {
      "title": "OpenAI Function Implementation",
      "description": "OpenAI function calling configuration",
      "type": "object",
      "required": ["provider", "type", "function"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["openai"],
          "description": "Provider identifier"
        },
        "type": {
          "type": "string",
          "enum": ["function"],
          "description": "OpenAI implementation type"
        },
        "function": {
          "type": "object",
          "required": ["name", "description", "parameters"],
          "additionalProperties": false,
          "properties": {
            "name": {
              "type": "string",
              "pattern": "^[a-zA-Z0-9_-]{1,64}$",
              "description": "Function name (must be valid OpenAI function name)"
            },
            "description": {
              "type": "string",
              "maxLength": 1024,
              "description": "Function description for the model"
            },
            "parameters": {
              "type": "object",
              "description": "JSON Schema for function parameters",
              "required": ["type", "properties"],
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["object"]
                },
                "properties": {
                  "type": "object",
                  "description": "Parameter definitions"
                },
                "required": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "Required parameter names"
                }
              }
            }
          }
        }
      }
    },
    {
      "title": "Local Implementation",
      "description": "Local execution implementation metadata",
      "type": "object",
      "required": ["provider", "runtime", "entry_point"],
      "additionalProperties": false,
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["local"],
          "description": "Provider identifier"
        },
        "runtime": {
          "type": "string",
          "enum": ["rust", "python", "bun", "node", "bash"],
          "description": "Runtime required to execute this implementation"
        },
        "entry_point": {
          "type": "string",
          "description": "Main file or function to execute"
        },
        "dependencies": {
          "type": "object",
          "description": "Runtime-specific dependencies",
          "properties": {
            "packages": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Required packages (pip, npm, cargo crates, etc.)"
            },
            "version": {
              "type": "string",
              "description": "Minimum runtime version"
            }
          }
        },
        "environment": {
          "type": "object",
          "description": "Required environment variables",
          "additionalProperties": {
            "type": "string"
          }
        }
      }
    }
  ],
  "examples": [
    {
      "provider": "claude",
      "type": "bash",
      "tool": {
        "name": "run_tests",
        "description": "Execute test suite with pytest",
        "parameters": {
          "command": "pytest {{test_path}} {{#if verbose}}-v{{/if}}",
          "working_dir": ".",
          "timeout": 300
        }
      }
    },
    {
      "provider": "openai",
      "type": "function",
      "function": {
        "name": "run_tests",
        "description": "Execute test suite and return results",
        "parameters": {
          "type": "object",
          "properties": {
            "test_path": {
              "type": "string",
              "description": "Path to test file or directory"
            },
            "verbose": {
              "type": "boolean",
              "description": "Enable verbose output"
            }
          },
          "required": ["test_path"]
        }
      }
    },
    {
      "provider": "local",
      "runtime": "python",
      "entry_point": "main",
      "dependencies": {
        "packages": ["pytest>=7.4", "pytest-cov>=4.1"],
        "version": "3.11"
      },
      "environment": {
        "PYTHONPATH": "."
      }
    }
  ]
}

