"""
Generated tests for FILE patterns.

Auto-generated by scripts/generate_pattern_tests.py
Generated at: 2025-12-09T00:11:38.118626

DO NOT EDIT MANUALLY - Changes will be overwritten.
To update tests, modify the test_cases in the pattern YAML files.
"""

import pytest
import re

# Import the validator
import sys
from pathlib import Path

# Add validators to path - find primitives relative to this test file
_test_dir = Path(__file__).parent
_repo_root = _test_dir
while _repo_root.name != "agentic-primitives" and _repo_root != _repo_root.parent:
    _repo_root = _repo_root.parent
_validators_path = _repo_root / "primitives" / "v1" / "hooks" / "validators"
if _validators_path.exists():
    sys.path.insert(0, str(_validators_path))

from security.file import validate, check_file_pattern, check_content_sensitive

class TestSensitiveFileEnvFile:
    """Tests for sensitive file pattern: environment file"""

    def test_case_1_blocked(self):
        """Test that '.env' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern(".env")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_2_blocked(self):
        """Test that '.env.local' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern(".env.local")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_3_blocked(self):
        """Test that '.env.production' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern(".env.production")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_4_allowed(self):
        """Test that 'config.env' is not detected as sensitive"""
        is_sensitive, reason = check_file_pattern("config.env")
        assert is_sensitive is False, f"Expected not sensitive, got {reason}"

class TestSensitiveFilePemCert:
    """Tests for sensitive file pattern: PEM certificate/key"""

    def test_case_1_blocked(self):
        """Test that 'server.pem' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("server.pem")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveFilePrivateKey:
    """Tests for sensitive file pattern: private key"""

    def test_case_1_blocked(self):
        """Test that 'private.key' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("private.key")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveFileSshRsa:
    """Tests for sensitive file pattern: SSH key"""

    def test_case_1_blocked(self):
        """Test that 'id_rsa' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("id_rsa")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_2_blocked(self):
        """Test that 'id_rsa.pub' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("id_rsa.pub")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveFileSshEd25519:
    """Tests for sensitive file pattern: SSH key"""

    def test_case_1_blocked(self):
        """Test that 'id_ed25519' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("id_ed25519")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveFileCredentialsJson:
    """Tests for sensitive file pattern: credentials file"""

    def test_case_1_blocked(self):
        """Test that 'credentials.json' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("credentials.json")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_2_blocked(self):
        """Test that 'credentials' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("credentials")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveFileSecretsYaml:
    """Tests for sensitive file pattern: secrets file"""

    def test_case_1_blocked(self):
        """Test that 'secrets.yaml' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("secrets.yaml")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

    def test_case_2_blocked(self):
        """Test that 'secrets.yml' is detected as sensitive"""
        is_sensitive, reason = check_file_pattern("secrets.yml")
        assert is_sensitive is True, f"Expected sensitive, got {reason}"

class TestSensitiveContentPrivateKeyHeader:
    """Tests for sensitive content pattern: private key"""

    def test_case_1_blocked(self):
        """Test that content containing '-----BEGIN RSA PRIVATE KEY----...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("-----BEGIN RSA PRIVATE KEY-----")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"

    def test_case_2_blocked(self):
        """Test that content containing '-----BEGIN OPENSSH PRIVATE KEY...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("-----BEGIN OPENSSH PRIVATE KEY-----")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"

    def test_case_3_allowed(self):
        """Test that content '-----BEGIN PUBLIC KEY-----...' is not flagged"""
        is_sensitive, reason, _ = check_content_sensitive("-----BEGIN PUBLIC KEY-----")
        assert is_sensitive is False, f"Expected not sensitive, got {reason}"

class TestSensitiveContentAwsAccessKey:
    """Tests for sensitive content pattern: AWS access key"""

    def test_case_1_blocked(self):
        """Test that content containing 'AKIAIOSFODNN7EXAMPLE...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("AKIAIOSFODNN7EXAMPLE")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"

class TestSensitiveContentGithubToken:
    """Tests for sensitive content pattern: GitHub token"""

    def test_case_1_blocked(self):
        """Test that content containing 'ghp_xxxxxxxxxxxxxxxxxxxxxxxxxx...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"

class TestSensitiveContentOpenaiKey:
    """Tests for sensitive content pattern: OpenAI API key"""

    def test_case_1_blocked(self):
        """Test that content containing 'sk-xxxxxxxxxxxxxxxxxxxxxxxxxxx...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"

class TestSensitiveContentSlackToken:
    """Tests for sensitive content pattern: Slack token"""

    def test_case_1_blocked(self):
        """Test that content containing 'xoxb-FAKE-TOKEN-FOR-TESTING-ON...' is detected"""
        is_sensitive, reason, _ = check_content_sensitive("xoxb-FAKE-TOKEN-FOR-TESTING-ONLY")
        assert is_sensitive is True, f"Expected sensitive content, got {reason}"
