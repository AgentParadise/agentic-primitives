"""
Generated tests for PII patterns.

Auto-generated by scripts/generate_pattern_tests.py
Generated at: 2025-12-08T23:43:52.035071

DO NOT EDIT MANUALLY - Changes will be overwritten.
To update tests, modify the test_cases in the pattern YAML files.
"""

import pytest
import re

# Import the validator
import sys
from pathlib import Path

# Add validators to path - find primitives relative to this test file
_test_dir = Path(__file__).parent
_repo_root = _test_dir
while _repo_root.name != "agentic-primitives" and _repo_root != _repo_root.parent:
    _repo_root = _repo_root.parent
_validators_path = _repo_root / "primitives" / "v1" / "hooks" / "validators"
if _validators_path.exists():
    sys.path.insert(0, str(_validators_path))

from prompt.pii import validate

class TestPIISsnFormatted:
    """Tests for PII pattern: SSN (risk: high)"""

    def test_case_1_detected(self):
        """Test that 'My SSN is 123-45-6789...' is detected as PII"""
        result = validate({"prompt": "My SSN is 123-45-6789"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

    def test_case_2_allowed(self):
        """Test that 'Call 123-456-7890...' is not flagged as PII"""
        result = validate({"prompt": "Call 123-456-7890"})
        assert result["safe"] is True

class TestPIISsnUnformatted:
    """Tests for PII pattern: potential SSN (9 digits) (risk: medium)"""

    def test_case_1_suspicious(self):
        """Test that 'SSN: 123456789...' is flagged in metadata"""
        result = validate({"prompt": "SSN: 123456789"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIVisaFormatted:
    """Tests for PII pattern: Visa card (risk: high)"""

    def test_case_1_detected(self):
        """Test that '4111-1111-1111-1111...' is detected as PII"""
        result = validate({"prompt": "4111-1111-1111-1111"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

    def test_case_2_detected(self):
        """Test that '4111 1111 1111 1111...' is detected as PII"""
        result = validate({"prompt": "4111 1111 1111 1111"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIVisaUnformatted:
    """Tests for PII pattern: Visa card (risk: high)"""

    def test_case_1_detected(self):
        """Test that '4111111111111111...' is detected as PII"""
        result = validate({"prompt": "4111111111111111"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIMastercardFormatted:
    """Tests for PII pattern: Mastercard (risk: high)"""

    def test_case_1_detected(self):
        """Test that '5500-0000-0000-0004...' is detected as PII"""
        result = validate({"prompt": "5500-0000-0000-0004"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIMastercardUnformatted:
    """Tests for PII pattern: Mastercard (risk: high)"""

    def test_case_1_detected(self):
        """Test that '5500000000000004...' is detected as PII"""
        result = validate({"prompt": "5500000000000004"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIAmexFormatted:
    """Tests for PII pattern: Amex card (risk: high)"""

    def test_case_1_detected(self):
        """Test that '3400-000000-00009...' is detected as PII"""
        result = validate({"prompt": "3400-000000-00009"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIAmexUnformatted:
    """Tests for PII pattern: Amex card (risk: high)"""

    def test_case_1_detected(self):
        """Test that '340000000000009...' is detected as PII"""
        result = validate({"prompt": "340000000000009"})
        # High risk PII should be blocked
        if "high" == "high":
            assert result["safe"] is False, f"Expected blocked for high-risk PII, got {result}"
        else:
            # Medium/low risk should be detected in metadata
            metadata = result.get("metadata")
            assert metadata is not None, "Expected metadata"
            detected = metadata.get("detected_pii", [])
            assert len(detected) > 0, "Expected PII detection in metadata"

class TestPIIUsPhone:
    """Tests for PII pattern: US phone number (risk: medium)"""

    def test_case_1_suspicious(self):
        """Test that '(555) 123-4567...' is flagged in metadata"""
        result = validate({"prompt": "(555) 123-4567"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

    def test_case_2_suspicious(self):
        """Test that '+1-555-123-4567...' is flagged in metadata"""
        result = validate({"prompt": "+1-555-123-4567"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIIntlPhone:
    """Tests for PII pattern: international phone (risk: medium)"""

    def test_case_1_suspicious(self):
        """Test that '+44 20 7946 0958...' is flagged in metadata"""
        result = validate({"prompt": "+44 20 7946 0958"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIEmail:
    """Tests for PII pattern: email address (risk: low)"""

    def test_case_1_suspicious(self):
        """Test that 'user@example.com...' is flagged in metadata"""
        result = validate({"prompt": "user@example.com"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIIpAddress:
    """Tests for PII pattern: IP address (risk: low)"""

    def test_case_1_suspicious(self):
        """Test that '192.168.1.1...' is flagged in metadata"""
        result = validate({"prompt": "192.168.1.1"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIDateMdy:
    """Tests for PII pattern: date (MM/DD/YYYY) (risk: low)"""

    def test_case_1_suspicious(self):
        """Test that '01/15/1990...' is flagged in metadata"""
        result = validate({"prompt": "01/15/1990"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

    def test_case_2_suspicious(self):
        """Test that '12-25-2000...' is flagged in metadata"""
        result = validate({"prompt": "12-25-2000"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestPIIDateYmd:
    """Tests for PII pattern: date (YYYY-MM-DD) (risk: low)"""

    def test_case_1_suspicious(self):
        """Test that '1990-01-15...' is flagged in metadata"""
        result = validate({"prompt": "1990-01-15"})
        metadata = result.get("metadata")
        # Should be detected but not necessarily blocked
        if metadata:
            detected = metadata.get("detected_pii", [])
            # Check detection or context
            assert len(detected) > 0 or metadata.get("detected_context"), f"Expected detection, got {metadata}"

class TestContextSsnContext:
    """Tests for context pattern: SSN context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests

class TestContextCreditCardContext:
    """Tests for context pattern: credit card context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests

class TestContextPhoneContext:
    """Tests for context pattern: phone context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests

class TestContextAddressContext:
    """Tests for context pattern: address context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests

class TestContextPasswordContext:
    """Tests for context pattern: password context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests

class TestContextBankingContext:
    """Tests for context pattern: banking context"""

    def test_context_detection(self):
        """Test that context pattern is detected"""
        # Context patterns raise awareness but don't block
        pass  # Context patterns tested via integration tests
