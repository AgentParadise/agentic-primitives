# User Prompt Tracking
# Tracks when users submit prompts to understand interaction patterns
#
# Use cases:
# - User engagement metrics (prompt frequency)
# - Prompt length analysis
# - Session activity patterns
# - User interaction timing

version: 1
id: user-prompt-tracking
name: "User Prompt Tracker"
description: "Track user prompt submissions for analytics"

# Only capture user prompt events
events:
  - UserPromptSubmit

# Two-stage analytics pipeline
middleware:
  # Stage 1: Normalize events
  - name: "analytics-normalizer"
    type: analytics
    impl: python
    path: "../../../services/analytics/middleware/event_normalizer.py"
    env:
      ANALYTICS_PROVIDER: "claude"
  
  # Stage 2: Publish events
  - name: "analytics-publisher"
    type: analytics
    impl: python
    path: "../../../services/analytics/middleware/event_publisher.py"
    env:
      ANALYTICS_PUBLISHER_BACKEND: "file"
      ANALYTICS_OUTPUT_PATH: "./analytics/user-prompts.jsonl"

execution: pipeline

# Output event: user_prompt_submitted
#
# Includes:
# - prompt: The full prompt text (be mindful of privacy/PII)
# - prompt_length: Character count
# - session_id: Links prompt to session
# - timestamp: When prompt was submitted
#
# Privacy note:
# The prompt field contains user input. Consider:
# - Filtering sensitive data before storage
# - Hashing prompts for privacy
# - Storing only prompt_length, not full text
# - Complying with data retention policies
#
# Example: Count prompts per session
# cat user-prompts.jsonl | jq -r '.session_id' | sort | uniq -c

