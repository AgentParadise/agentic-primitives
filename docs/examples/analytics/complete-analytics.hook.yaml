# Complete Analytics Collection
# Tracks ALL analytics events for comprehensive monitoring
#
# Use cases:
# - Full agent activity monitoring
# - Comprehensive analytics database
# - Debugging and troubleshooting
# - Complete audit trail

version: 1
id: complete-analytics
name: "Complete Analytics Collector"
description: "Track all analytics events for comprehensive monitoring"

# Capture ALL hook events that generate analytics
events:
  - SessionStart       # Session begins
  - SessionEnd         # Session ends
  - UserPromptSubmit   # User submits prompt
  - PreToolUse         # Before tool execution
  - PostToolUse        # After tool execution
  - PermissionRequest  # Permission dialog shown
  - Stop               # Agent stops responding
  - SubagentStop       # Subagent stops
  - Notification       # System notification
  - PreCompact         # Before context compaction

# Two-stage analytics pipeline
middleware:
  # Stage 1: Normalize provider-specific events
  - name: "analytics-normalizer"
    type: analytics
    impl: python
    path: "../../../services/analytics/middleware/event_normalizer.py"
    env:
      # Provider name - adjust for your AI provider
      ANALYTICS_PROVIDER: "claude"
      
      # Optional: Enable debug logging for troubleshooting
      # ANALYTICS_DEBUG: "true"
  
  # Stage 2: Publish normalized events to backend
  - name: "analytics-publisher"
    type: analytics
    impl: python
    path: "../../../services/analytics/middleware/event_publisher.py"
    env:
      # Backend type: "file" for local JSONL, "api" for remote service
      ANALYTICS_PUBLISHER_BACKEND: "file"
      
      # File backend configuration
      ANALYTICS_OUTPUT_PATH: "./analytics/all-events.jsonl"
      
      # API backend configuration (commented out, uncomment to use)
      # ANALYTICS_PUBLISHER_BACKEND: "api"
      # ANALYTICS_API_ENDPOINT: "https://analytics.example.com/api/events"
      # ANALYTICS_API_TIMEOUT: "30"
      # ANALYTICS_RETRY_ATTEMPTS: "3"

execution: pipeline

# This hook captures the complete analytics story:
#
# Session lifecycle:
# - session_started: When session begins
# - session_completed: When session ends
#
# User interaction:
# - user_prompt_submitted: User submits prompt
#
# Tool execution:
# - tool_execution_started: Before tool runs
# - tool_execution_completed: After tool completes
# - permission_requested: Permission dialog shown
#
# Agent control:
# - agent_stopped: Main agent stops
# - subagent_stopped: Subagent stops
#
# System events:
# - system_notification: System sends notification
# - context_compacted: Context window compacted
#
# Output: Single JSONL file with all events, each line is a JSON object
# with normalized schema. Use jq for querying:
#
# # Count events by type
# cat all-events.jsonl | jq -r '.event_type' | sort | uniq -c
#
# # Extract all tool names
# cat all-events.jsonl | jq -r 'select(.event_type | startswith("tool_")) | .context.tool_name' | sort | uniq
#
# # Find session duration
# cat all-events.jsonl | jq -r 'select(.event_type | contains("session")) | {session_id, event_type, timestamp}'

