# Claude Code Analytics Configuration
# Optimized for Claude Code with Claude-specific settings
#
# This configuration is tailored for Claude Code's hook system:
# - Tracks all 10 Claude hook events
# - Uses Claude-specific field mappings
# - Configured for Claude's execution environment

version: 1
id: claude-analytics
name: "Claude Code Analytics"
description: "Complete analytics collection optimized for Claude Code"

# All Claude Code hook events
events:
  - SessionStart       # Session lifecycle
  - SessionEnd
  - UserPromptSubmit   # User interaction
  - PreToolUse         # Tool execution
  - PostToolUse
  - PermissionRequest  # Permission management
  - Stop               # Agent control
  - SubagentStop
  - Notification       # System events
  - PreCompact

middleware:
  # Stage 1: Claude event normalizer
  - name: "claude-event-normalizer"
    type: analytics
    impl: python
    path: "${CLAUDE_PROJECT_DIR}/services/analytics/middleware/event_normalizer.py"
    env:
      # Claude provider
      ANALYTICS_PROVIDER: "claude"
      
      # Enable debug for initial setup
      ANALYTICS_DEBUG: "false"
  
  # Stage 2: Event publisher
  - name: "analytics-publisher"
    type: analytics
    impl: python
    path: "${CLAUDE_PROJECT_DIR}/services/analytics/middleware/event_publisher.py"
    env:
      # File backend: Store in Claude project directory
      ANALYTICS_PUBLISHER_BACKEND: "file"
      ANALYTICS_OUTPUT_PATH: "${CLAUDE_PROJECT_DIR}/.claude/analytics/events.jsonl"
      
      # API backend alternative (uncomment to use)
      # ANALYTICS_PUBLISHER_BACKEND: "api"
      # ANALYTICS_API_ENDPOINT: "https://your-analytics-api.com/events"
      # ANALYTICS_API_TIMEOUT: "30"
      # ANALYTICS_RETRY_ATTEMPTS: "3"

execution: pipeline

# Claude-specific notes:
#
# 1. Environment variables:
#    - ${CLAUDE_PROJECT_DIR}: Claude Code provides this automatically
#    - Points to the root directory where Claude was started
#
# 2. Output location:
#    - Stored in .claude/analytics/ within project
#    - Won't interfere with .claude/settings.json
#    - Easy to gitignore (.claude/ typically ignored)
#
# 3. Claude hook events mapped to analytics:
#    - SessionStart → session_started
#    - SessionEnd → session_completed
#    - UserPromptSubmit → user_prompt_submitted
#    - PreToolUse → tool_execution_started
#    - PostToolUse → tool_execution_completed
#    - PermissionRequest → permission_requested
#    - Stop → agent_stopped
#    - SubagentStop → subagent_stopped
#    - Notification → system_notification
#    - PreCompact → context_compacted
#
# 4. Integrating with Claude Code:
#    Add to ~/.claude/settings.json or .claude/settings.json:
#
#    {
#      "hooks": {
#        "PreToolUse": [{
#          "matcher": "*",
#          "hooks": [{
#            "type": "command",
#            "command": "agentic run-hook path/to/claude-analytics.hook.yaml"
#          }]
#        }],
#        "PostToolUse": [{
#          "matcher": "*",
#          "hooks": [{
#            "type": "command",
#            "command": "agentic run-hook path/to/claude-analytics.hook.yaml"
#          }]
#        }]
#        // ... repeat for other events
#      }
#    }
#
# 5. Viewing analytics:
#    cd ${CLAUDE_PROJECT_DIR}
#    cat .claude/analytics/events.jsonl | jq .
#    cat .claude/analytics/events.jsonl | jq -r '.event_type' | sort | uniq -c

